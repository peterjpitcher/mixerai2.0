# Content Template System

## Overview

The Content Template System will replace the current static content types (Article, Owned PDP, Retailer PDP) with a flexible template designer that allows users to create custom content types with configurable input and output fields.

## Core Functionality

### Template Designer

1. **Visual Template Builder**
   - Drag-and-drop interface for adding and reordering fields
   - Ability to group fields into sections
   - Preview of template structure (field layout only, not content)

2. **Template Management**
   - Create, edit, and delete templates
   - Template listing with search and filtering
   - Templates stored as JSON configurations

3. **Field Types**
   - **Input Fields**: Fields that require user input when creating content
   - **Output Fields**: Fields that will be generated by AI based on input fields

### Input Field Types

1. **Short Text** (single line)
   - Character limits (min/max)
   - Placeholder text
   - Validation rules (regex, required)

2. **Long Text** (multi-line)
   - Word/character limits
   - Markdown support
   - Placeholder text

3. **Rich Text**
   - Basic formatting (bold, italic, underline)
   - Lists (ordered, unordered)
   - Links
   - Tables

4. **Select/Dropdown**
   - Single-select or multi-select
   - Custom options
   - Option groups

5. **Number**
   - Min/max values
   - Step size
   - Unit display

6. **Date/Time**
   - Date picker
   - Time picker
   - Range selection

7. **Keywords/Tags**
   - Tag input with autocomplete
   - Character limits per tag
   - Maximum number of tags

8. **URL**
   - Validation
   - Link previews

9. **File Upload**
   - Image upload
   - File type restrictions
   - Size limits

### Output Field Types

1. **Plain Text**
   - Character/word count
   - Formatting options (uppercase, lowercase, title case)

2. **Rich Text**
   - Full formatting options (headings, bold, italic, etc.)
   - Embedded content (images, videos)
   - Tables
   - Code blocks
   - Lists

3. **HTML**
   - Direct HTML output
   - Preview rendering

### AI Features

1. **AI Suggester**
   - Configurable per input field
   - Custom prompt for each field
   - Suggestion button next to field
   - Multiple suggestion options

2. **AI Auto-Complete**
   - Configurable per output field
   - Uses all filled input fields as context
   - Multiple generation options
   - Regeneration capability

3. **Prompt Configuration**
   - Custom prompt template for each field
   - Variables to include other field values
   - Ability to set system message for brand voice consistency

## User Flow

### Template Creation

1. User navigates to "Template Designer" in admin area
2. Creates a new template with name and description
3. Adds and configures input fields
   - Sets field name, type, and properties
   - Configures AI features if needed
4. Adds and configures output fields
   - Sets field name, type, and properties
   - Configures AI generation settings
5. Saves the template

### Content Creation

1. User selects a template from the "New Content" dropdown
2. System generates a dynamic form based on the template
3. User fills in input fields
   - Can use AI Suggester for assistance on fields with that feature
4. User clicks "Generate" button
5. System processes all inputs and generates content for output fields
   - Uses AI Auto-Complete for each configured field
6. User can edit the generated content as needed
7. User saves the content

## Technical Requirements

### Database Schema

1. **Templates Table**
   ```sql
   CREATE TABLE content_templates (
     id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
     name TEXT NOT NULL,
     description TEXT,
     icon TEXT,
     fields JSONB NOT NULL,
     created_by UUID REFERENCES profiles(id) ON DELETE SET NULL,
     created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
     updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );
   ```

2. **Content Table Updates**
   ```sql
   ALTER TABLE content
   ADD COLUMN template_id UUID REFERENCES content_templates(id),
   ADD COLUMN content_data JSONB;
   ```

### API Endpoints

1. **Template Management**
   - `GET /api/content-templates` - List all templates
   - `GET /api/content-templates/:id` - Get template details
   - `POST /api/content-templates` - Create template
   - `PUT /api/content-templates/:id` - Update template
   - `DELETE /api/content-templates/:id` - Delete template

2. **AI Integration**
   - `POST /api/ai/suggest` - Get field suggestions
   - `POST /api/ai/generate` - Generate content for output fields

3. **Content Management**
   - Updates to existing content endpoints to handle dynamic templates

### Frontend Components

1. **Template Designer**
   - Template form
   - Field configuration panels
   - Field type components
   - AI configuration interface

2. **Content Editor**
   - Dynamic form generation based on template
   - AI integration components
   - WYSIWYG editor for rich text fields

## Implementation Phases

### Phase 1: Database & API Foundation
- Create database schema for templates
- Implement basic template CRUD API
- Remove legacy content type code

### Phase 2: Template Designer UI
- Build template designer interface
- Implement field type components
- Create template management screens

### Phase 3: AI Integration
- Integrate OpenAI for field suggestions
- Implement auto-complete functionality
- Build prompt configuration interface

### Phase 4: Content Creation
- Update content creation flow to use templates
- Build dynamic form generation
- Implement preview and editing capabilities

### Phase 5: Testing & Optimization
- Test with various template configurations
- Optimize AI prompt handling
- Performance testing for large templates

## UI Mockups

### Template Designer
```
+-----------------------------------------------+
| Template Designer: [Template Name]            |
+-----------------------------------------------+
| Description: [                           ]    |
+-----------------------------------------------+
| Fields                         | Preview      |
|--------------------------+-----|-------------|
| [+ Add Field]            |     |             |
|                          |     |             |
| Input Fields:            |     |             |
| - Title (Short Text)     |     |             |
| - Keywords (Tags)        |     |             |
| - Brief (Long Text)      |     |             |
|                          |     |             |
| Output Fields:           |     |             |
| - Content (Rich Text)    |     |             |
| - Meta Description       |     |             |
|                          |     |             |
|--------------------------+-----|-------------|
|        [Cancel]    [Save Template]           |
+-----------------------------------------------+
```

### Field Configuration
```
+-----------------------------------------------+
| Configure Field                               |
+-----------------------------------------------+
| Field Name: [                            ]    |
| Field Type: [Rich Text        â–¼]              |
| Required:   [x]                               |
+-----------------------------------------------+
| Field Options:                                |
|                                               |
| Min Words: [  100  ]  Max Words: [  500  ]    |
|                                               |
+-----------------------------------------------+
| AI Features:                                  |
|                                               |
| [ ] Enable AI Suggester                       |
| [x] Enable AI Auto-Complete                   |
|                                               |
| AI Prompt Template:                           |
| [                                        ]    |
| [                                        ]    |
+-----------------------------------------------+
|        [Cancel]    [Save Field]               |
+-----------------------------------------------+
```

## Migration Strategy

1. **Code Cleanup**
   - Remove all code related to the legacy content types
   - Update navigation to remove hard-coded content type links

2. **Database Migration**
   - Create new tables without disrupting existing content
   - Add new columns to content table

3. **Gradual Rollout**
   - Implement template system alongside existing content
   - Allow template creation and testing
   - Switch content creation to use only templates 